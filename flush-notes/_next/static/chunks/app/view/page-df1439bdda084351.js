(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{5856:function(){},7761:function(){},2678:function(){},5819:function(){},4112:function(){},629:function(t,i,e){Promise.resolve().then(e.bind(e,8815))},8815:function(t,i,e){"use strict";e.r(i),e.d(i,{default:function(){return c}});var n=e(7437),s=e(2265),r=e(9149),a=e(4033);let o=()=>{var t,i;let e=new URLSearchParams((null===(i=window)||void 0===i?void 0:null===(t=i.location)||void 0===t?void 0:t.search)||""),n=e.get("id")||"",s=e.get("key")||"";return{key:s,id:n}};var u=e(7923),l=e(6309),c=()=>{let t=(0,a.useRouter)(),{id:i,key:e}=o(),[c,d]=s.useState("");return(s.useEffect(()=>{if(!i){t.replace("/404");return}u.$.readNote(i,e).then(t=>d(t||""))},[i,e,d,t]),c)?(0,n.jsx)(r.U,{children:c}):(0,n.jsx)(l.g,{})}},6309:function(t,i,e){"use strict";e.d(i,{g:function(){return s}});var n=e(7437);let s=()=>(0,n.jsx)("div",{className:"loading-block",children:(0,n.jsx)("p",{children:"Loading..."})})},1177:function(t,i,e){"use strict";var n,s;e.d(i,{c:function(){return n},m:function(){return r}});let r="/flush-notes/1/note/proto";(s=n||(n={})).Initializing="Initializing...",s.WaitingForPeers="Waiting for peers...",s.Connected="Connected",s.Failed="Failed to initialize(see logs)"},7923:function(t,i,e){"use strict";e.d(i,{$:function(){return l}});var n=e(7441),s=e(1177),r=e(5136),a=e(8089),o=e(9710);class u{async createNote(t){var i;let e=(0,r.oQ)(),u=(0,r.Mf)({contentTopic:s.m,symKey:e,pubsubTopic:n.H5.pubsubTopic}),l=self.crypto.randomUUID();if(36!==l.length)throw"Unexpected uuid length";let c=await n.H5.send(u,{payload:(0,a.iY)(l+t)});return(null==c?void 0:null===(i=c.failures)||void 0===i?void 0:i.length)&&c.failures.length>0&&console.error("Failures when pushing note: ",c.failures.map(t=>t.error)),{id:l,key:(0,o.ci)(e)}}async readNote(t,i){await this.initMessages((0,o.nr)(i));let e=this.messages.map(t=>{try{let i=(0,a.Md)(t.payload),e=i.substring(0,36),n=i.substring(36);return{id:e,content:n}}catch(t){console.log("Failed to read message:",t)}}).find(i=>{if((null==i?void 0:i.id)===t)return!0});return null==e?void 0:e.content}async initMessages(t){if(this.subscription)return;let i=(0,r.UF)(s.m,t,n.H5.pubsubTopic);this.messages=await n.H5.getHistory(i),this.subscription=await n.H5.subscribe(i,t=>{this.messages.push(t)})}constructor(){this.messages=[]}}let l=new u},7441:function(t,i,e){"use strict";e.d(i,{H5:function(){return u},J9:function(){return n}});var n,s=e(1177),r=e(8089),a=e(9527);(n||(n={})).Status="status";class o{async init(){if(!this.initialized&&!this.initializing){this.initializing=!0;try{this.emitStatusEvent(s.c.Initializing),this.pubsubTopic=(0,a.L3)(s.m);let t=await (0,r.pq)({defaultBootstrap:!0,contentTopics:[s.m]});await t.start(),this.emitStatusEvent(s.c.WaitingForPeers),await (0,r.gT)(t,[r.Uw.Filter,r.Uw.LightPush,r.Uw.Store]),this.node=t,this.initialized=!0,this.emitStatusEvent(s.c.Connected)}catch(t){console.error("Failed to initialize Waku node:",t),this.emitStatusEvent(s.c.Failed)}this.initializing=!1}}addEventListener(t,i){return this.emitter.addEventListener(t,i)}removeEventListener(t,i){return this.emitter.removeEventListener(t,i)}send(t,i){var e;return this.ensureWakuInitialized(),null===(e=this.node)||void 0===e?void 0:e.lightPush.send(t,i)}async getHistory(t){this.ensureWakuInitialized();let i=[];for await(let e of this.node.store.queryGenerator([t])){let t=await Promise.all(e),n=t.filter(t=>!!t);i=[...i,...n]}return i}async subscribe(t,i){return this.ensureWakuInitialized(),this.node.filter.subscribe(t,i)}emitStatusEvent(t){this.emitter.dispatchEvent(new CustomEvent("status",{detail:t}))}ensureWakuInitialized(){if(!this.initialized){let t="Waku is not initialized.";throw console.log(t),Error(t)}}constructor(){this.emitter=new EventTarget,this.initialized=!1,this.initializing=!1}}let u=new o}},function(t){t.O(0,[948,990,149,971,472,744],function(){return t(t.s=629)}),_N_E=t.O()}]);