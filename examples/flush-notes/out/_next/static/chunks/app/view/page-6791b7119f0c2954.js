(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{5856:function(){},7761:function(){},2678:function(){},5819:function(){},4112:function(){},7039:function(t,e,i){Promise.resolve().then(i.bind(i,8815))},8815:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return c}});var n=i(7437),s=i(2265),r=i(8020),a=i(4033);let u=()=>{let t=(0,a.usePathname)(),e=(0,a.useSearchParams)(),i=t.split("/"),n=i.indexOf("view"),s=e.get("key"),r=i[n+1];return{key:s,id:r}};var o=i(7923),l=i(6309),c=()=>{let t=(0,a.useRouter)(),{id:e,key:i}=u(),[c,d]=s.useState("");return(s.useEffect(()=>{if(!e){t.replace("/404");return}o.$.readNote(e,i).then(t=>d(t||""))},[e,i,d]),c)?(0,n.jsx)(r.U,{children:c}):(0,n.jsx)(l.g,{})}},6309:function(t,e,i){"use strict";i.d(e,{g:function(){return s}});var n=i(7437);let s=()=>(0,n.jsx)("div",{className:"loading-block",children:(0,n.jsx)("p",{children:"Loading..."})})},1177:function(t,e,i){"use strict";var n,s;i.d(e,{c:function(){return n},m:function(){return r}});let r="/flush-notes/1/note/proto";(s=n||(n={})).Initializing="Initializing...",s.WaitingForPeers="Waiting for peers...",s.Connected="Connected",s.Failed="Failed to initialize(see logs)"},7923:function(t,e,i){"use strict";i.d(e,{$:function(){return l}});var n=i(7441),s=i(1177),r=i(7660),a=i(5302),u=i(9710);class o{async createNote(t){let e=(0,r.oQ)(),i=(0,r.Mf)({contentTopic:s.m,symKey:e}),o=self.crypto.randomUUID();if(36!==o.length)throw"Unexpected uuid length";return await n.H5.send(i,{payload:(0,a.iY)(o+t)}),{id:o,key:(0,u.ci)(e)}}async readNote(t,e){await this.initMessages((0,u.nr)(e));let i=this.messages.map(t=>{try{let e=(0,a.Md)(t.payload),i=e.substring(0,36),n=e.substring(36);return{id:i,content:n}}catch(t){console.log("Failed to read message:",t)}}).find(e=>{if((null==e?void 0:e.id)===t)return!0});return null==i?void 0:i.content}async initMessages(t){if(this.subscription)return;let e=(0,r.UF)(s.m,t);this.messages=await n.H5.getHistory(e),this.subscription=await n.H5.subscribe(e,t=>{this.messages.push(t)})}constructor(){this.messages=[]}}let l=new o},7441:function(t,e,i){"use strict";i.d(e,{H5:function(){return u},J9:function(){return n}});var n,s=i(1177),r=i(5302);(n||(n={})).Status="status";class a{async init(){if(!this.initialized&&!this.initializing){this.initializing=!0;try{this.emitStatusEvent(s.c.Initializing);let t=await (0,r.pq)({defaultBootstrap:!0});await t.start(),this.emitStatusEvent(s.c.WaitingForPeers),await (0,r.gT)(t,[r.Uw.Filter,r.Uw.LightPush,r.Uw.Store]),this.node=t,this.initialized=!0,this.emitStatusEvent(s.c.Connected)}catch(t){console.error("Failed to initialize Waku node:",t),this.emitStatusEvent(s.c.Failed)}this.initializing=!1}}addEventListener(t,e){return this.emitter.addEventListener(t,e)}removeEventListener(t,e){return this.emitter.removeEventListener(t,e)}send(t,e){var i;return this.ensureWakuInitialized(),null===(i=this.node)||void 0===i?void 0:i.lightPush.send(t,e)}async getHistory(t){this.ensureWakuInitialized();let e=[];for await(let i of this.node.store.queryGenerator([t])){let t=await Promise.all(i),n=t.filter(t=>!!t);e=[...e,...n]}return e}async subscribe(t,e){return this.ensureWakuInitialized(),this.node.filter.subscribe(t,e)}emitStatusEvent(t){this.emitter.dispatchEvent(new CustomEvent("status",{detail:t}))}ensureWakuInitialized(){if(!u.initialized){let t="Waku is not initialized.";throw console.log(t),Error(t)}}constructor(){this.emitter=new EventTarget,this.initialized=!1,this.initializing=!1}}let u=new a}},function(t){t.O(0,[324,421,20,971,472,744],function(){return t(t.s=7039)}),_N_E=t.O()}]);